# Configuration file for SOMANET CIRCULO 7, Option FSoE, Safe Motion drive
vendor_id: 0x000022d2
product_id: 0x00000302
assign_activate: 0x0300 # DC Synch register
auto_fault_reset: false # true = automatic fault reset, false = fault reset on rising edge command interface "reset_fault"
#sdo: # sdo data to be transferred at drive startup
#  - { index: 0x60C2, sub_index: 1, type: int8, value: 10 } # Set interpolation time for cyclic modes to 10 ms
#  - { index: 0x60C2, sub_index: 2, type: int8, value: -3 } # Set base 10-3s
# Source: for communication area indices: https://doc.synapticon.com/circulo_safe_motion/sw5.1/object_dict/communication_area.html
rpdo: # RxPDO = receive PDO Mapping, master (out) to slave (in) (MOSI)
  # Source: https://doc.synapticon.com/circulo_safe_motion/sw5.1/object_dict/pdo/rxpdo.html
  - index: 0x1600
    channels:
      - {
          index: 0x6040,
          sub_index: 0,
          type: uint16,
          command_interface: control_word,
          state_interface: control_word,
          default: 0,
        } # Control word
      - {
          index: 0x6060,
          sub_index: 0,
          type: int8,
          command_interface: mode_of_operation,
          default: 8,
        } # Modes of operation. Modes are: position (8), velocity (9), effort (10) and homing (6)
      - {
          index: 0x6071,
          sub_index: 0,
          type: int16,
          command_interface: effort,
          default: 0,
        } # Target torque
      - {
          index: 0x607a,
          sub_index: 0,
          type: int32,
          command_interface: position,
          default: .nan,
          factor: 166886.053607527
        } # Target position
      - {
          index: 0x60ff,
          sub_index: 0,
          type: int32,
          command_interface: velocity,
          default: 0,
          factor: 9549.2965855
        } # Target velocity
      - { index: 0x60b2, sub_index: 0, type: int16, default: 0 } # Offset torque
      - { index: 0x2701, sub_index: 0, type: int32, default: 0 } # Tuning command
  - index: 0x1601
    channels:
      - { index: 0x60fe, sub_index: 1, type: uint32, default: 0 } # Physical outputs
      - { index: 0x60fe, sub_index: 2, type: uint32, default: 0 } # Bit mask for physical outputs
  - index: 0x1602
    channels:
      - { index: 0x2703, sub_index: 0, type: uint32, default: 0 } # User MOSI
      - { index: 0x60b1, sub_index: 0, type: int32, default: 0 } # Offset velocity
  # FSoE Safe RxPDO objects (source: https://doc.synapticon.com/circulo_safe_motion/smm/safe_rxpdo.htm)
  - index: 0x1700
    channels:
      - { index: 0x6770, sub_index: 1, type: uint8 } # FSoE Command
      - { index: 0x6640, sub_index: 0, type: bool, state_interface: sto_cmd_state, mask: 1 } # STO
      - { index: 0x6650, sub_index: 1, type: bool, state_interface: ss1_cmd_state, mask: 2 } # SS1
      - { skip: true, index: 0x6670, sub_index: 0x01, type: bool, mask: 1 } # SS2
      - { skip: true, index: 0x6668, sub_index: 0x01, type: bool, mask: 1 } # SOS
      - { skip: true, index: 0x0000, sub_index: 0, type: bit3 } # RxPadding
      - { skip: true, index: 0x6632, sub_index: 0, type: bool, mask: 1 } # Error acknowledge
      - { index: 0x6690, sub_index: 1, type: bool, state_interface: sls1_cmd_state, mask: 1 } # SLS Instance 1
      - { index: 0x6690, sub_index: 2, type: bool, state_interface: sls2_cmd_state, mask: 2 } # SLS Instance 2
      - { skip: true, index: 0x6690, sub_index: 3, type: bool, mask: 1 } # SLS Instance 3
      - { skip: true, index: 0x6690, sub_index: 4, type: bool, mask: 2 } # SLS Instance 4
      - { skip: true, index: 0x6630, sub_index: 0, type: bool, mask: 1 } # Restart acknowledge
      - { skip: true, index: 0x6660, sub_index: 0, type: bool, mask: 1 } # SBC command
      - { skip: true, index: 0x260a, sub_index: 0, type: bool, mask: 1 } # Reset position
      - { skip: true, index: 0x0000, sub_index: 0, type: bool, mask: 1 } # RxPadding
      - { skip: true, index: 0x6770, sub_index: 3, type: uint16 } # FSoE CRC_0
      - { skip: true, index: 0x0000, sub_index: 0, type: uint8 } # RxPadding
      - { skip: true, index: 0x0000, sub_index: 0, type: bit4 } # RxPadding
      - { skip: true, index: 0x26f0, sub_index: 1, type: bool, mask: 1 } # Safe output 1
      - { skip: true, index: 0x26f0, sub_index: 2, type: bool, mask: 2 } # Safe output 2
      - { skip: true, index: 0x0000, sub_index: 0, type: bit2 } # RxPadding
      - { skip: true, index: 0x6770, sub_index: 4, type: uint16 } # FSoE CRC_1
      - { skip: true, index: 0x6770, sub_index: 2, type: uint16 } # FSoE ConnectionID
      - { skip: true, index: 0x0000, sub_index: 0, type: uint8 } # RxPadding
tpdo: # TxPDO = transmit PDO Mapping, slave (out) to master (in) (MISO)
  # Source: https://doc.synapticon.com/circulo_safe_motion/sw5.1/object_dict/pdo/txpdo.html
  - index: 0x1a00
    channels:
      - {
          index: 0x6041,
          sub_index: 0,
          type: uint16,
          state_interface: status_word,
        } # Status word
      - {
          index: 0x6061,
          sub_index: 0,
          type: int8,
          state_interface: mode_of_operation,
        } # Mode of operation display
      - { index: 0x6064, sub_index: 0, type: int32, state_interface: position, factor: 5.992112453e-06  } # Position actual value
      - { index: 0x606c, sub_index: 0, type: int32, state_interface: velocity, factor: 0.1047198e-03  } # Velocity actual value
#      - { index: 0x606c, sub_index: 0, type: int32, state_interface: velocity  } # Velocity actual value
      - { index: 0x6077, sub_index: 0, type: int16, state_interface: effort } # Torque actual value
  - index: 0x1a01
    channels:
      - {
          index: 0x2401,
          sub_index: 0,
          type: uint16,
          state_interface: analog_input_1,
        } # Analog input 1
      - {
          index: 0x2402,
          sub_index: 0,
          type: uint16,
          state_interface: analog_input_2,
        } # Analog input 2
      - {
          index: 0x2403,
          sub_index: 0,
          type: uint16,
          state_interface: analog_input_3,
        } # Analog input 3
      - {
          index: 0x2404,
          sub_index: 0,
          type: uint16,
          state_interface: analog_input_4,
        } # Analog input 4
      - { index: 0x2702, sub_index: 0, type: uint32 } # Tuning status
  - index: 0x1a02
    channels:
      - {
          index: 0x60fd,
          sub_index: 0,
          type: uint32,
          state_interface: digital_inputs_1,
        } # Digital inputs
      - { 
          index: 0x6621, 
          sub_index: 1, 
          type: int8, 
          data_mapping: [
          {
              addr_offset: 0,
              type: bool,
              mask:  1,
              state_interface: smm_sto_state 
          }, 
          {
              addr_offset: 0,
              type: bool,
              mask:  8,
              state_interface: smm_sos_state 
          },
          {
              addr_offset: 0,
              type: bool,
              mask:  128,
              state_interface: smm_error_active_state 
          }
          ]
        } # Safety statusword Byte 1
      - { index: 0x6621, sub_index: 2, type: int8, state_interface: smm_state_2 } # Safety statusword Byte 2
      - { index: 0x6621, sub_index: 3, type: int8, state_interface: smm_state_3 } # Safety statusword Byte 3
      - { index: 0x6621, sub_index: 4, type: int8, state_interface: smm_state_4 } # Safety statusword Byte 4
  - index: 0x1a03
    channels:
      - { index: 0x2704, sub_index: 0, type: uint32 } # User MISO
      - { index: 0x20f0, sub_index: 0, type: uint32 } # Timestamp, unit Âµs
      - { index: 0x60fc, sub_index: 0, type: int32 } # Position demand internal value
      - { index: 0x606b, sub_index: 0, type: int32 } # Velocity demand value
      - { index: 0x6074, sub_index: 0, type: int16 } # Torque demand value
  # FSoE Safe TxPDO objects (source: https://doc.synapticon.com/circulo_safe_motion/smm/safe_txpdo.htm)
  - index: 0x1b00
    channels:
      - { index: 0x6760, sub_index: 1, type: uint8 } # FSoE Command
      - { skip: true, index: 0x6640, sub_index: 0, type: bool, mask: 1 } # STO state
      - { skip: true, index: 0x0000, sub_index: 0, type: bit2 } # TxPadding
      - { skip: true, index: 0x6668, sub_index: 1, type: bool, mask: 1 } # SOS state
      - { skip: true, index: 0x0000, sub_index: 0, type: bit3 } # TxPadding
      - { index: 0x6632, sub_index: 0, type: bool, state_interface: err_cmd_state, mask: 128 } # Error state
      - { skip: true, index: 0x6650, sub_index: 1, type: bool, mask: 1 } # SS1 state
      - { skip: true, index: 0x6670, sub_index: 1, type: bool, mask: 1 } # SS2 state
      - { skip: true, index: 0x0000, sub_index: 0, type: bit2 } # TxPadding
      - { skip: true, index: 0x6690, sub_index: 1, type: bool, mask: 1 } # SLS Instance 1 state
      - { skip: true, index: 0x6690, sub_index: 2, type: bool, mask: 2 } # SLS Instance 2 state
      - { skip: true, index: 0x6690, sub_index: 3, type: bool, mask: 4 } # SLS Instance 3 state
      - { skip: true, index: 0x6690, sub_index: 4, type: bool, mask: 8 } # SLS Instance 4 state
      - { skip: true, index: 0x6768, sub_index: 3, type: uint16 } # FSoE CRC_0
      - { index: 0x6630, sub_index: 0, type: bool, state_interface: ack_restart_cmd_state, mask: 1 } # Restart acknowledge required
      - { skip: true, index: 0x6660, sub_index: 0, type: bool, mask: 1 } # SBC state
      - { skip: true, index: 0x2600, sub_index: 0, type: bool, mask: 1 } # Temperature warning
      - { index: 0x2601, sub_index: 0, type: bool, state_interface: safe_position_valid, mask: 8 } # Safe position valid
      - { index: 0x2602, sub_index: 0, type: bool, state_interface: safe_velocity_valid, mask: 16 } # Safe speed valid
      - { skip: true, index: 0x0000, sub_index: 0, type: bit3 } # TxPadding
      - { skip: true, index: 0x2603, sub_index: 1, type: bool, mask: 1 } # Safe input 1
      - { skip: true, index: 0x2603, sub_index: 2, type: bool, mask: 2 } # Safe input 2
      - { skip: true, index: 0x2603, sub_index: 3, type: bool, mask: 4 } # Safe input 3
      - { skip: true, index: 0x2603, sub_index: 4, type: bool, mask: 8 } # Safe input 4
      - { skip: true, index: 0x2604, sub_index: 1, type: bool, mask: 1 } # Safe output monitor 1
      - { skip: true, index: 0x2604, sub_index: 2, type: bool, mask: 2 } # Safe output monitor 2
      - { skip: true, index: 0x2605, sub_index: 1, type: bool, mask: 1 } # Analog diagnostic active (single channel)
      - { skip: true, index: 0x2605, sub_index: 1, type: bool, mask: 1 } # Analog value valid
      - { skip: true, index: 0x6760, sub_index: 4, type: uint16 } # FSoE CRC_1
      - { index: 0x6611, sub_index: 0, state_interface: safe_position, type: uint16 } # Safe position actual value low
      - { skip: true, index: 0x6760, sub_index: 5, type: uint16 } # FSoE CRC_2
      - { skip: true, index: 0x0000, sub_index: 0, type: uint16 } # TxPadding
      - { skip: true, index: 0x6760, sub_index: 6, type: uint16 } # FSoE CRC_3
      - { index: 0x6613, sub_index: 0, state_interface: safe_velocity, type: int16 } # Safe velocity actual value low
      - { skip: true, index: 0x6760, sub_index: 7, type: uint16 } # FSoE CRC_4
      - { skip: true, index: 0x0000, sub_index: 0, type: uint16 } # TxPadding
      - { skip: true, index: 0x6760, sub_index: 8, type: uint16 } # FSoE CRC_5
      - { skip: true, index: 0x2605, sub_index: 3, type: int16 } # Safe analog value (scaled)
      - { skip: true, index: 0x6760, sub_index: 9, type: uint16 } # FSoE CRC_6
      - { skip: true, index: 0x6760, sub_index: 2, type: uint16 } # FSoE ConnectionID
#      - { skip: true, index: 0x0000, sub_index: 0, type: uint8 } # SAFETY DATA CIRCULO PB WORKAROUND
#  - index: 0x1a04
#    channels:
#      - { index: 0x0000, sub_index: 0, type: uint8 } # User MOSI

sm: # Sync Manager
  - { index: 0, type: output, watchdog: disable }
  - { index: 1, type: input, watchdog: disable }
  - { index: 2, type: output, pdo: rpdo, watchdog: enable }
  - { index: 3, type: input, pdo: tpdo, watchdog: disable }